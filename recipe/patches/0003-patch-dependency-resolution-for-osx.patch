From 7fe176b4ad50b1648ad4c284eb50dfcb42440515 Mon Sep 17 00:00:00 2001
From: Giordon Stark <kratsg@gmail.com>
Date: Wed, 12 Feb 2025 08:02:37 -0800
Subject: [PATCH] patching

---
 src/libSpec/CMakeLists.txt |  3 +++
 src/libYarr/CMakeLists.txt | 11 ++++++++++-
 2 files changed, 13 insertions(+), 1 deletion(-)

diff --git a/src/libSpec/CMakeLists.txt b/src/libSpec/CMakeLists.txt
index 645a2c1f..86e6c731 100644
--- a/src/libSpec/CMakeLists.txt
+++ b/src/libSpec/CMakeLists.txt
@@ -18,6 +18,9 @@ post_build_debug_library(Spec)
 target_include_directories(Spec PRIVATE ../libYarr/include)
 target_include_directories(Spec PRIVATE ../libUtil/include)
 target_include_directories(Spec PUBLIC ./include)
+if(APPLE)
+    target_link_options(Spec PRIVATE "-Wl,-undefined,dynamic_lookup")
+endif()

 LIST(APPEND apps
 	specReadWriteReg
diff --git a/src/libYarr/CMakeLists.txt b/src/libYarr/CMakeLists.txt
index 9a5e3c61..7ad7124e 100644
--- a/src/libYarr/CMakeLists.txt
+++ b/src/libYarr/CMakeLists.txt
@@ -6,7 +6,13 @@ target_include_directories(Yarr PRIVATE ../libUtil/include)
 target_include_directories(Yarr PUBLIC ./include)
 target_link_libraries(Yarr ${CONTROLLERS})
 target_link_libraries(Yarr ${FRONT_ENDS})
-target_link_options(Yarr PUBLIC -Wl,--no-as-needed)
+if(APPLE)
+  set(YARR_LINK_OPTION "-Wl,-undefined,dynamic_lookup")
+else()
+  set(YARR_LINK_OPTION "-Wl,--no-as-needed")
+endif()
+
+target_link_options(Yarr PUBLIC ${YARR_LINK_OPTION})
 add_dependencies(Yarr git_hash)

 post_build_debug_library(Yarr)
@@ -47,6 +53,9 @@ add_library(Scan SHARED
 target_include_directories(Scan PRIVATE ../libUtil/include)
 target_include_directories(Scan PUBLIC ./include)
 target_link_libraries(Scan Util pthread)
+if(APPLE)
+    target_link_options(Scan PRIVATE "-Wl,-undefined,dynamic_lookup")
+endif()

 post_build_debug_library(Scan)

--
2.45.2

